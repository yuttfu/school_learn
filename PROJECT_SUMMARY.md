# è‡ªåŠ¨é©¾é©¶äº¤é€šä»¿çœŸç³»ç»Ÿ - é¡¹ç›®æ€»ç»“

## é¡¹ç›®ä¿¡æ¯

**é¡¹ç›®åç§°**: MuJoCo è‡ªåŠ¨é©¾é©¶äº¤é€šä»¿çœŸç³»ç»Ÿ
**åˆ›å»ºæ—¥æœŸ**: 2026-01-15
**MuJoCoç‰ˆæœ¬**: 3.4.0
**Pythonç‰ˆæœ¬**: 3.8+

## Windows æœ¬åœ°è·¯å¾„
```
D:\Desktop\program\é¡¹ç›®\äº¤é€š\
```

## è™šæ‹Ÿæœºè·¯å¾„
```
/home/y/æ¡Œé¢/äº¤é€š/
```

## é¡¹ç›®æ¶æ„

### æ ¸å¿ƒç»„ä»¶

#### 1. åœºæ™¯æ¨¡å‹ (traffic_scene.xml)
- **é“è·¯ç³»ç»Ÿ**: 100ç±³Ã—10.8ç±³ä¸‰è½¦é“é«˜é€Ÿå…¬è·¯
- **è½¦è¾†**: 1è¾†ä¸»è½¦ + 3è¾†NPCè½¦è¾†
- **ç¯å¢ƒ**: æ²¥é’è·¯é¢ã€è‰åœ°ã€è½¦é“çº¿ã€äº¤é€šä¿¡å·ç¯
- **ä¼ æ„Ÿå™¨**: 16ä¸ªä¼ æ„Ÿå™¨ï¼ˆä½ç½®ã€é€Ÿåº¦ã€IMUã€è½¦è½®ç¼–ç å™¨ç­‰ï¼‰
- **æ‰§è¡Œå™¨**: 4ä¸ªï¼ˆ2ä¸ªè½¬å‘ + 2ä¸ªé©±åŠ¨ï¼‰

#### 2. è½¦è¾†åŠ¨åŠ›å­¦
- **è´¨é‡**: 1500 kg
- **æƒ¯æ€§çŸ©é˜µ**: diag[600, 2000, 2200] kgÂ·mÂ²
- **è½®èƒ**: 4è½®ç‹¬ç«‹å»ºæ¨¡
  - ç›´å¾„: 0.7ç±³
  - æ‘©æ“¦ç³»æ•°: 1.5ï¼ˆçºµå‘ï¼‰, 0.8ï¼ˆæ¨ªå‘ï¼‰
- **è½¬å‘**: å‰è½®Â±35åº¦
- **é©±åŠ¨**: åè½®é©±åŠ¨ï¼Œæœ€å¤§500 NÂ·m

#### 3. ä¼ æ„Ÿå™¨ç³»ç»Ÿ (traffic_env.py)
```python
class VehicleSensors:
    - get_position()           # 3Dä½ç½®
    - get_orientation()        # å››å…ƒæ•°å§¿æ€
    - get_velocity()           # çº¿é€Ÿåº¦
    - get_angular_velocity()   # è§’é€Ÿåº¦
    - get_acceleration()       # åŠ é€Ÿåº¦
    - get_wheel_speeds()       # 4è½®è½¬é€Ÿ
    - get_steering_angles()    # è½¬å‘è§’
    - get_tire_contacts()      # è½®èƒæ¥è§¦åŠ›
```

#### 4. æ§åˆ¶ç­–ç•¥
**PIDæ§åˆ¶å™¨**:
```python
steering = Kp * lane_offset + Ki * âˆ«lane_offset + Kd * d(lane_offset)/dt
```

**ç®€åŒ–MPC**:
- é¢„æµ‹æ—¶åŸŸ: 10æ­¥
- æ§åˆ¶è¾“å‡º: è½¬å‘è§’ + æ²¹é—¨/åˆ¹è½¦

#### 5. Gymnasiumç¯å¢ƒ
**è§‚å¯Ÿç©ºé—´** (9ç»´):
```
[x, y, vx, vy, yaw, yaw_rate, lane_offset, heading_error, distance_to_goal]
```

**åŠ¨ä½œç©ºé—´** (2ç»´):
```
[steering_angle, throttle]  # [-1, 1]
```

**å¥–åŠ±å‡½æ•°**:
```python
reward = -1.0 * lane_offset       # è½¦é“ä¿æŒ
         -0.5 * heading_error     # èˆªå‘ä¿æŒ
         -0.1 * velocity_error    # é€Ÿåº¦æ§åˆ¶
         -0.01 * actionÂ²          # å¹³æ»‘æ§åˆ¶
         +1.0 * progress          # å‰è¿›å¥–åŠ±
         -100.0 * collision       # ç¢°æ’æƒ©ç½š
```

## æ–‡ä»¶æ¸…å•

| æ–‡ä»¶å | å¤§å° | è¯´æ˜ |
|--------|------|------|
| traffic_scene.xml | 15KB | åœºæ™¯å®šä¹‰ (v1) |
| traffic_scene_v2.xml | 18KB | **ä¼˜åŒ–åœºæ™¯ (v2)** - çœŸå®æ‚¬æŒ‚+è¯¦ç»†å»ºæ¨¡ |
| traffic_env.py | 21KB | Gymnasiumç¯å¢ƒ+ä¼ æ„Ÿå™¨+æ§åˆ¶å™¨ |
| train_rl.py | 12KB | RLè®­ç»ƒè„šæœ¬ï¼ˆSAC/TD3/PPOï¼‰ |
| run_manual.py | 4.7KB | æ‰‹åŠ¨æ§åˆ¶è„šæœ¬ |
| test_scene.py | 2.8KB | æ— GUIæµ‹è¯•è„šæœ¬ |
| test_v2.py | 4.0KB | v2æ¨¡å‹æµ‹è¯•è„šæœ¬ |
| requirements.txt | 270B | ä¾èµ–åˆ—è¡¨ |
| README.md | 9.7KB | å®Œæ•´æ–‡æ¡£ |
| start.sh | 1.5KB | å¿«é€Ÿå¯åŠ¨è„šæœ¬ |
| V2_IMPROVEMENTS.md | 5.2KB | **v2æ”¹è¿›è¯´æ˜æ–‡æ¡£** |

## ä½¿ç”¨åœºæ™¯

### 1. ç ”ç©¶ç”¨é€”
- è‡ªåŠ¨é©¾é©¶ç®—æ³•å¼€å‘
- å¼ºåŒ–å­¦ä¹ ç®—æ³•éªŒè¯
- è½¦è¾†åŠ¨åŠ›å­¦ç ”ç©¶
- ä¼ æ„Ÿå™¨èåˆç ”ç©¶

### 2. æ•™å­¦ç”¨é€”
- è‡ªåŠ¨é©¾é©¶è¯¾ç¨‹å®éªŒ
- å¼ºåŒ–å­¦ä¹ å®è·µ
- è½¦è¾†æ§åˆ¶ç†è®º
- MuJoCoä»¿çœŸæ•™å­¦

### 3. åŸå‹å¼€å‘
- å¿«é€ŸéªŒè¯æ§åˆ¶ç­–ç•¥
- ç®—æ³•æ€§èƒ½è¯„ä¼°
- Sim-to-Realå‡†å¤‡

## å¿«é€Ÿå¼€å§‹

### Windows æœ¬åœ°
```bash
cd D:\Desktop\program\é¡¹ç›®\äº¤é€š

# æ‰‹åŠ¨æ§åˆ¶
python run_manual.py

# PIDæ¼”ç¤º
python train_rl.py --mode demo

# æµ‹è¯•ç¯å¢ƒ
python traffic_env.py
```

### è™šæ‹Ÿæœº (Linux)
```bash
cd /home/y/æ¡Œé¢/äº¤é€š

# ä½¿ç”¨å¯åŠ¨è„šæœ¬
./start.sh

# æˆ–ç›´æ¥è¿è¡Œ
python3 run_manual.py
```

## æ€§èƒ½æŒ‡æ ‡

| æŒ‡æ ‡ | å€¼ |
|------|------|
| ä»¿çœŸé€Ÿåº¦ | 50 FPS |
| ä¼ æ„Ÿå™¨æ•°é‡ | 16ä¸ª |
| æ¿€å…‰é›·è¾¾åˆ†è¾¨ç‡ | 360çº¿ |
| ç›¸æœºåˆ†è¾¨ç‡ | 640Ã—480 |
| åŠ¨ä½œå»¶è¿Ÿ | <4ms |
| å†…å­˜å ç”¨ | <500MB |

## æ‰©å±•æ–¹å‘

### ğŸ‰ v2 æ¨¡å‹å·²å®Œæˆ (2026-01-15)
- âœ… çœŸå®æ‚¬æŒ‚ç³»ç»Ÿï¼ˆ4ä¸ªç‹¬ç«‹å¼¹ç°§-é˜»å°¼å™¨ï¼‰
- âœ… è¯¦ç»†è½¦èº«å»ºæ¨¡ï¼ˆå¼•æ“ç›–ã€è½¦ç¯ã€åè§†é•œã€é€æ˜çª—æˆ·ï¼‰
- âœ… é«˜è´¨é‡æè´¨ï¼ˆé‡‘å±å…‰æ³½ã€é“¬åˆé‡‘è½®æ¯‚ã€ç»ç’ƒåå°„ï¼‰
- âœ… å¤šæ ·åŒ–NPCè½¦è¾†ï¼ˆSUVã€è½¿è½¦ã€è·‘è½¦ï¼‰
- âœ… 20ä¸ªä¼ æ„Ÿå™¨ï¼ˆæ–°å¢4ä¸ªæ‚¬æŒ‚ä¼ æ„Ÿå™¨ï¼‰
- âœ… 4ä¸ªç‹¬ç«‹æ‰§è¡Œå™¨ï¼ˆå·¦å³è½¬å‘ã€å·¦å³é©±åŠ¨ï¼‰
- ğŸ“„ æŸ¥çœ‹ `V2_IMPROVEMENTS.md` äº†è§£è¯¦ç»†æ”¹è¿›

### çŸ­æœŸ (1-2å‘¨)
1. âœ… ç†Ÿæ‚‰æ‰‹åŠ¨æ§åˆ¶
2. âœ… æµ‹è¯•PIDæ§åˆ¶å™¨
3. âš¡ è®­ç»ƒRLæ¨¡å‹ï¼ˆéœ€å®‰è£… stable-baselines3ï¼‰
4. âš¡ è°ƒæ•´å¥–åŠ±å‡½æ•°

### ä¸­æœŸ (1-2æœˆ)
1. å®ç°å˜é“åŠŸèƒ½
2. æ·»åŠ æ›´å¤šNPCè½¦è¾†
3. å®ç°äº¤é€šä¿¡å·ç¯é€»è¾‘
4. å¤šæ™ºèƒ½ä½“è®­ç»ƒ

### é•¿æœŸ (3-6æœˆ)
1. é›†æˆçœŸå®è½¨è¿¹æ•°æ®
2. å®ç°ç«¯åˆ°ç«¯è§†è§‰æ§åˆ¶
3. Sim-to-Realè½¬ç§»
4. å®è½¦æµ‹è¯•

## æŠ€æœ¯äº®ç‚¹

### 1. çœŸå®çš„è½¦è¾†åŠ¨åŠ›å­¦
- 4è½®ç‹¬ç«‹å»ºæ¨¡
- ç²¾ç¡®çš„æƒ¯æ€§å‚æ•°
- çœŸå®çš„è½®èƒæ‘©æ“¦

### 2. å®Œæ•´çš„ä¼ æ„Ÿå™¨å¥—ä»¶
- IMUï¼ˆ6è‡ªç”±åº¦ï¼‰
- æ¿€å…‰é›·è¾¾ï¼ˆ360Â°æ‰«æï¼‰
- ç›¸æœºï¼ˆRGBå›¾åƒï¼‰
- è½¦è½®ç¼–ç å™¨ï¼ˆ4ä¸ªï¼‰

### 3. çµæ´»çš„æ§åˆ¶æ¥å£
- PIDæ§åˆ¶ï¼ˆåŸºçº¿ï¼‰
- MPCæ§åˆ¶ï¼ˆé«˜çº§ï¼‰
- RLæ§åˆ¶ï¼ˆè‡ªé€‚åº”ï¼‰

### 4. æ ‡å‡†åŒ–ç¯å¢ƒ
- Gymnasium API
- æ”¯æŒå‘é‡åŒ–
- æ˜“äºé›†æˆRLåº“

## å¸¸è§ä»»åŠ¡

### è®­ç»ƒè‡ªå·±çš„æ¨¡å‹
```bash
# å®‰è£…RLåº“
pip3 install stable-baselines3 tensorboard

# å¼€å§‹è®­ç»ƒï¼ˆSACç®—æ³•ï¼‰
python3 train_rl.py --mode train --algorithm SAC --timesteps 1000000 --n_envs 4

# ç›‘æ§è®­ç»ƒ
tensorboard --logdir logs/

# è¯„ä¼°æ¨¡å‹
python3 train_rl.py --mode evaluate --model_path models/SAC/best_model.zip
```

### ä¿®æ”¹åœºæ™¯
```xml
<!-- åœ¨ traffic_scene.xml ä¸­ -->

<!-- æ·»åŠ æ–°è½¦è¾† -->
<body name="npc_vehicle_4" pos="5 -3.6 0.3">
  ...
</body>

<!-- ä¿®æ”¹é“è·¯é•¿åº¦ -->
<geom name="main_road" type="box" size="100 5.4 0.05"/>

<!-- è°ƒæ•´æ‘©æ“¦ç³»æ•° -->
<geom friction="1.5 0.8 0.5"/>
```

### è‡ªå®šä¹‰å¥–åŠ±
```python
# åœ¨ traffic_env.py ä¸­ä¿®æ”¹ _compute_reward()
def _compute_reward(self):
    # ä½ çš„è‡ªå®šä¹‰å¥–åŠ±é€»è¾‘
    custom_reward = ...
    return custom_reward, terminated, info
```

## é—®é¢˜æ’æŸ¥

### è½¦è¾†ä¸åŠ¨
- æ£€æŸ¥æ‰§è¡Œå™¨é…ç½®
- ç¡®è®¤æ²¹é—¨å€¼æ˜¯å¦åº”ç”¨
- æŸ¥çœ‹ data.ctrl æ˜¯å¦æ›´æ–°

### è½¦è¾†ç¿»å€’
- é™ä½è´¨å¿ƒé«˜åº¦
- å¢åŠ åº•ç›˜è´¨é‡
- æ£€æŸ¥æƒ¯æ€§çŸ©é˜µ

### è½¬å‘ä¸çµ
- å¢åŠ è½¬å‘æ‰§è¡Œå™¨kp
- æ£€æŸ¥è½¬å‘è§’é™åˆ¶
- ç¡®è®¤å‰è½®è½¬å‘å…³èŠ‚

### è®­ç»ƒä¸æ”¶æ•›
- ç®€åŒ–å¥–åŠ±å‡½æ•°
- é™ä½å­¦ä¹ ç‡
- ä½¿ç”¨è¯¾ç¨‹å­¦ä¹ 
- å¢åŠ æ¢ç´¢

## èµ„æºé“¾æ¥

- **MuJoCoæ–‡æ¡£**: https://mujoco.readthedocs.io/
- **Gymnasium**: https://gymnasium.farama.org/
- **Stable-Baselines3**: https://stable-baselines3.readthedocs.io/
- **è½¦è¾†åŠ¨åŠ›å­¦**: https://en.wikipedia.org/wiki/Vehicle_dynamics

## è‡´è°¢

æ„Ÿè°¢ä»¥ä¸‹å¼€æºé¡¹ç›®ï¼š
- MuJoCo (DeepMind)
- Gymnasium (Farama Foundation)
- Stable-Baselines3 (DLR-RM)

---

**å¼€å‘**: Claude Code + ç”¨æˆ·åä½œ
**æ—¥æœŸ**: 2026-01-15
**çŠ¶æ€**: âœ… å®Œæˆå¹¶éƒ¨ç½²

## ä¸‹ä¸€æ­¥

1. åœ¨è™šæ‹Ÿæœºè¿è¡Œ `./start.sh` é€‰æ‹©æ¨¡å¼1ä½“éªŒæ‰‹åŠ¨æ§åˆ¶
2. è¿è¡Œ `python3 train_rl.py --mode demo` æŸ¥çœ‹PIDæ§åˆ¶æ¼”ç¤º
3. å¦‚æœæƒ³è®­ç»ƒRLæ¨¡å‹ï¼Œå®‰è£… `pip3 install --break-system-packages stable-baselines3`
4. é˜…è¯» README.md äº†è§£æ‰€æœ‰åŠŸèƒ½å’ŒAPI

ç¥ä½¿ç”¨æ„‰å¿«ï¼ğŸš—
